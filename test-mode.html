<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mode Test - Chasse aux Emoji Secrets</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/card.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <style>
        /* Styles sp√©cifiques au mode test */
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .test-description {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .emoji-card {
            background-color: #f5f5f5;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            touch-action: manipulation;
        }

        .emoji-card:active {
            transform: scale(0.95);
        }

        .emoji-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .emoji-card.found {
            background-color: #e3f2fd;
            border: 2px solid #2196f3;
        }

        .emoji-icon-large {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .emoji-title {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .emoji-description {
            font-size: 0.8rem;
            color: #666;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .test-footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .generate-card-button {
            background-color: #6e8efb;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 30px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            touch-action: manipulation;
        }

        .generate-card-button:hover {
            background-color: #5d7de9;
            transform: translateY(-2px);
        }

        .generate-card-button:active {
            transform: scale(0.95);
        }

        /* Adaptations pour le mobile */
        @media (max-width: 480px) {
            .emoji-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .emoji-icon-large {
                font-size: 2.5rem;
            }

            h1 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body style="background: linear-gradient(135deg, #6e8efb 0%, #a777e3 100%); min-height: 100vh; padding: 20px;">
<div class="test-container">
    <h1 style="text-align: center; color: #6e8efb; margin-bottom: 20px;">Mode Test - Chasse aux Emoji Secrets</h1>
    <p class="test-description">
        Ce mode vous permet d'essayer toutes les interactions sans avoir besoin des marqueurs AR.
        Cliquez sur un emoji pour lancer son interaction!
    </p>

    <div class="emoji-grid" id="emoji-grid">
        <!-- Les cartes d'emoji seront g√©n√©r√©es ici par JavaScript -->
    </div>

    <div class="test-footer">
        <div id="progress-display" style="margin-bottom: 15px; font-weight: bold;"></div>
        <button class="generate-card-button" id="generate-card-button">G√©n√©rer la carte d'identit√© digitale</button>
    </div>
</div>

<!-- Conteneur pour les interactions -->
<div class="interaction-container" id="interaction-container" style="display: none;">
    <div class="interaction-wrapper" id="interaction-wrapper">
        <!-- Le contenu sera g√©n√©r√© dynamiquement en fonction de l'emoji trouv√© -->
    </div>
</div>

<!-- √âcran de f√©licitations et carte d'identit√© digitale -->
<div class="complete-screen" id="complete-screen" style="display: none;">
    <h1 class="congrats-title">F√©licitations!</h1>
    <p>Vous avez d√©couvert au moins 5 emojis secrets.</p>
    <p>Voici votre carte d'identit√© digitale Ynov!</p>

    <div class="digital-card" id="digital-card">
        <!-- La carte sera g√©n√©r√©e dynamiquement -->
    </div>

    <div class="share-buttons">
        <button class="button" id="download-button">T√©l√©charger</button>
        <button class="button" id="share-button">Partager</button>
    </div>

    <button class="button" id="continue-button">Continuer</button>
</div>

<!-- Scripts de l'application r√©elle (pas de simulations) -->
<script src="js/utils.js"></script>
<script src="js/emoji-manager.js"></script>
<script src="js/card-generator.js"></script>

<!-- Scripts des interactions r√©elles -->
<script src="js/interactions/computer.js"></script>
<script src="js/interactions/security.js"></script>
<script src="js/interactions/gaming.js"></script>
<script src="js/interactions/architecture.js"></script>
<script src="js/interactions/video.js"></script>
<script src="js/interactions/design.js"></script>
<script src="js/interactions/ai.js"></script>
<script src="js/interactions/marketing.js"></script>
<script src="js/interactions/business.js"></script>

<script>
    // Donn√©es des emojis
    const emojiData = {
        'informatique': {
            emoji: 'üíª',
            title: 'Informatique',
            description: 'Concevez et d√©veloppez des applications et syst√®mes informatiques innovants.'
        },
        'cybersecurite': {
            emoji: 'üîí',
            title: 'Cybers√©curit√©',
            description: 'Prot√©gez les syst√®mes d\'information contre les menaces et attaques.'
        },
        'gaming': {
            emoji: 'üéÆ',
            title: '3D, Animation & Jeux Vid√©o',
            description: 'Cr√©ez des univers virtuels, des personnages et des exp√©riences interactives.'
        },
        'architecture': {
            emoji: 'üè†',
            title: 'Architecture d\'int√©rieur',
            description: 'Concevez des espaces fonctionnels, esth√©tiques et innovants.'
        },
        'audiovisuel': {
            emoji: 'üé¨',
            title: 'Audiovisuel',
            description: 'R√©alisez des productions audiovisuelles professionnelles et cr√©atives.'
        },
        'design': {
            emoji: 'üé®',
            title: 'Cr√©ation & Digital Design',
            description: 'Cr√©ez des exp√©riences utilisateur et des interfaces attractives.'
        },
        'ai': {
            emoji: 'ü§ñ',
            title: 'Intelligence Artificielle & Data',
            description: 'Exploitez les donn√©es et l\'IA pour cr√©er des solutions intelligentes.'
        },
        'marketing': {
            emoji: 'üì±',
            title: 'Marketing & Communication Digitale',
            description: '√âlaborez des strat√©gies marketing efficaces dans l\'univers num√©rique.'
        },
        'business': {
            emoji: 'üíº',
            title: 'Tech & Business',
            description: 'Combinez comp√©tences techniques et manag√©riales pour piloter des projets innovants.'
        }
    };

    // Configuration de l'application
    const appConfig = {
        minEmojisRequired: 5,
        emojiData: emojiData
    };

    // Gestionnaire d'emojis et g√©n√©rateur de carte
    let emojiManager, cardGenerator;

    // Interactions associ√©es √† chaque emoji - utilisons les vraies fonctions
    const interactions = {
        'informatique': computerInteraction,
        'cybersecurite': securityInteraction,
        'gaming': gamingInteraction,
        'architecture': architectureInteraction,
        'audiovisuel': videoInteraction,
        'design': designInteraction,
        'ai': aiInteraction,
        'marketing': marketingInteraction,
        'business': businessInteraction
    };

    // Attendre que le DOM soit charg√©
    document.addEventListener('DOMContentLoaded', function() {
        // Initialiser le gestionnaire d'emojis
        emojiManager = new EmojiManager(emojiData);

        // Initialiser le g√©n√©rateur de carte
        cardGenerator = new CardGenerator(emojiManager, appConfig);

        // G√©n√©rer la grille d'emojis
        generateEmojiGrid();

        // Configurer les boutons
        document.getElementById('generate-card-button').addEventListener('click', generateCard);
        document.getElementById('continue-button').addEventListener('click', hideCard);
        document.getElementById('download-button').addEventListener('click', downloadCard);
        document.getElementById('share-button').addEventListener('click', shareCard);

        // √âcouter les √©v√©nements d'emoji trouv√©
        document.addEventListener('emojiFound', function(event) {
            updateEmojiGrid();
            updateProgressDisplay();
        });

        // Initialiser l'affichage de la progression
        updateProgressDisplay();

        // V√©rifier la progression d√©j√† existante (pour le localStorage)
        updateEmojiGrid();
    });

    // G√©n√©rer la grille d'emojis
    function generateEmojiGrid() {
        const grid = document.getElementById('emoji-grid');
        grid.innerHTML = '';

        Object.keys(emojiData).forEach(emojiId => {
            const data = emojiData[emojiId];
            const card = document.createElement('div');
            card.className = 'emoji-card';
            card.dataset.emojiId = emojiId;

            if (emojiManager && emojiManager.isFound(emojiId)) {
                card.classList.add('found');
            }

            card.innerHTML = `
                    <div class="emoji-icon-large">${data.emoji}</div>
                    <div class="emoji-title">${data.title}</div>
                    <div class="emoji-description">${data.description}</div>
                `;

            // Ajouter l'√©v√©nement de clic
            card.addEventListener('click', function() {
                const emojiId = this.dataset.emojiId;

                // Marquer l'emoji comme trouv√©
                emojiManager.markAsFound(emojiId);

                // Lancer l'interaction
                triggerInteraction(emojiId);
            });

            grid.appendChild(card);
        });
    }

    // Mettre √† jour l'affichage des emojis trouv√©s
    function updateEmojiGrid() {
        if (!emojiManager) return;

        const cards = document.querySelectorAll('.emoji-card');
        cards.forEach(card => {
            const emojiId = card.dataset.emojiId;
            if (emojiManager.isFound(emojiId)) {
                card.classList.add('found');
            } else {
                card.classList.remove('found');
            }
        });
    }

    // Mettre √† jour l'affichage de la progression
    function updateProgressDisplay() {
        if (!emojiManager) return;

        const progressDisplay = document.getElementById('progress-display');
        const foundCount = emojiManager.getFoundCount();
        const totalCount = Object.keys(emojiData).length;

        progressDisplay.textContent = `Emojis trouv√©s : ${foundCount}/${totalCount}`;

        // Activer ou d√©sactiver le bouton de g√©n√©ration de carte
        const generateButton = document.getElementById('generate-card-button');
        if (foundCount >= appConfig.minEmojisRequired) {
            generateButton.disabled = false;
            generateButton.style.opacity = '1';
        } else {
            generateButton.disabled = true;
            generateButton.style.opacity = '0.5';
        }
    }

    // D√©clencher l'interaction pour un emoji
    function triggerInteraction(emojiId) {
        const interactionFunction = interactions[emojiId];
        const emojiData = emojiManager.getEmojiData(emojiId);

        if (interactionFunction && emojiData) {
            // Emp√™cher le d√©filement du corps
            document.body.classList.add('interaction-active');

            // Montrer le conteneur d'interaction
            const interactionContainer = document.getElementById('interaction-container');
            const interactionWrapper = document.getElementById('interaction-wrapper');

            interactionContainer.style.display = 'flex';
            interactionContainer.classList.add('fade-in');

            // Vider le wrapper
            interactionWrapper.innerHTML = '';

            // Appeler la fonction d'interaction r√©elle
            interactionFunction(interactionWrapper, emojiData, function() {
                // Callback lorsque l'interaction est termin√©e
                interactionContainer.classList.add('fade-out');

                // D√©lai avant de masquer le conteneur
                setTimeout(function() {
                    interactionContainer.style.display = 'none';
                    interactionContainer.classList.remove('fade-out');
                    interactionWrapper.innerHTML = '';

                    // R√©activer le d√©filement du corps
                    document.body.classList.remove('interaction-active');
                }, 500);
            });
        }
    }

    // G√©n√©rer la carte d'identit√©
    function generateCard() {
        if (emojiManager.getFoundCount() < appConfig.minEmojisRequired) {
            alert(`Vous devez trouver au moins ${appConfig.minEmojisRequired} emojis pour g√©n√©rer la carte!`);
            return;
        }

        // G√©n√©rer la carte
        cardGenerator.generateCard();

        // Emp√™cher le d√©filement du corps
        document.body.classList.add('interaction-active');

        // Afficher l'√©cran de f√©licitations
        const digitalCard = document.getElementById('digital-card');
        digitalCard.innerHTML = cardGenerator.getCardHTML();

        const completeScreen = document.getElementById('complete-screen');
        completeScreen.style.display = 'flex';
        completeScreen.classList.add('fade-in');
    }

    // Masquer la carte
    function hideCard() {
        const completeScreen = document.getElementById('complete-screen');
        completeScreen.classList.add('fade-out');
        setTimeout(function() {
            completeScreen.style.display = 'none';
            completeScreen.classList.remove('fade-out');

            // R√©activer le d√©filement du corps
            document.body.classList.remove('interaction-active');
        }, 500);
    }

    // T√©l√©charger la carte
    function downloadCard() {
        html2canvas(document.getElementById('digital-card')).then(function(canvas) {
            const link = document.createElement('a');
            link.download = 'carte-ynov-campus.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        });
    }

    // Partager la carte
    function shareCard() {
        html2canvas(document.getElementById('digital-card')).then(function(canvas) {
            canvas.toBlob(function(blob) {
                // Si l'API Web Share est disponible
                if (navigator.share) {
                    const file = new File([blob], 'carte-ynov-campus.png', { type: 'image/png' });

                    navigator.share({
                        title: 'Ma carte d\'identit√© digitale Ynov Campus',
                        text: 'Voici ma carte d\'identit√© digitale Ynov Campus obtenue lors de la Chasse aux Emoji Secrets!',
                        files: [file]
                    }).catch(function(error) {
                        console.error('Erreur lors du partage:', error);
                        // Fallback: ouvrir dans un nouvel onglet
                        window.open(canvas.toDataURL('image/png'));
                    });
                } else {
                    // Fallback: ouvrir dans un nouvel onglet
                    window.open(canvas.toDataURL('image/png'));
                }
            });
        });
    }
</script>
</body>
</html>